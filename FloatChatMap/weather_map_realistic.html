<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Weather Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://unpkg.com/leaflet-velocity@1.9.0/dist/leaflet-velocity.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #weatherMap {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
        }
        
        /* Professional weather app style controls */
        .weather-controls {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 8px;
            z-index: 1000;
            display: flex;
            gap: 5px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .weather-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 25px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
            position: relative;
        }
        
        .weather-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .weather-btn.active {
            color: white;
            background: rgba(74, 144, 226, 0.3);
        }
        
        .weather-btn.active::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: #4a90e2;
            border-radius: 2px;
        }
        
        /* Location display badge */
        .location-badge {
            position: fixed;
            top: 120px;
            left: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px 20px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .location-badge h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .location-coords {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Time control bar */
        .time-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 15px 30px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .time-display {
            font-size: 16px;
            font-weight: 500;
            min-width: 150px;
        }
        
        .time-slider {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Weather info panel */
        .weather-panel {
            position: fixed;
            top: 120px;
            right: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            z-index: 1000;
            min-width: 250px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .weather-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .weather-item:last-child {
            border-bottom: none;
        }
        
        .weather-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .weather-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .temp-value { color: #ff6b6b; }
        .wind-value { color: #4dabf7; }
        .precip-value { color: #69db7c; }
        .aqi-value { color: #feca57; }
        
        /* Legend */
        .map-legend {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .legend-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .legend-scale {
            width: 200px;
            height: 15px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Realistic gradients */
        .temp-gradient {
            background: linear-gradient(to right, 
                rgb(5, 48, 97) 0%,
                rgb(33, 102, 172) 10%,
                rgb(67, 147, 195) 20%,
                rgb(146, 197, 222) 30%,
                rgb(209, 229, 240) 40%,
                rgb(247, 247, 247) 50%,
                rgb(253, 219, 199) 60%,
                rgb(244, 165, 130) 70%,
                rgb(214, 96, 77) 80%,
                rgb(178, 24, 43) 90%,
                rgb(103, 0, 31) 100%
            );
        }
        
        .wind-gradient {
            background: linear-gradient(to right,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(128, 212, 255, 0.3) 25%,
                rgba(0, 153, 255, 0.5) 50%,
                rgba(0, 85, 170, 0.7) 75%,
                rgba(0, 0, 139, 0.9) 100%
            );
        }
        
        .precip-gradient {
            background: linear-gradient(to right,
                rgba(0, 0, 0, 0) 0%,
                rgba(115, 178, 255, 0.3) 20%,
                rgba(0, 132, 255, 0.5) 40%,
                rgba(255, 170, 0, 0.7) 60%,
                rgba(255, 0, 0, 0.8) 80%,
                rgba(200, 0, 255, 0.9) 100%
            );
        }
        
        .aqi-gradient {
            background: linear-gradient(to right,
                rgb(0, 228, 0) 0%,
                rgb(255, 255, 0) 25%,
                rgb(255, 126, 0) 50%,
                rgb(255, 0, 0) 75%,
                rgb(153, 0, 76) 100%
            );
        }
        
        /* Search controls */
        .search-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .search-input {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            width: 100px;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .search-btn {
            padding: 8px 20px;
            background: #4a90e2;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #5ba0f2;
        }
        
        /* Loading animation */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #4a90e2;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="weatherMap"></div>
    
    <!-- Search Panel -->
    <div class="search-panel">
        <input type="number" class="search-input" id="latInput" placeholder="Lat" value="23.2" step="0.1">
        <input type="number" class="search-input" id="lonInput" placeholder="Lon" value="77.4" step="0.1">
        <button class="search-btn" onclick="updateLocation()">
            <i class="fas fa-search"></i> Search
        </button>
    </div>
    
    <!-- Weather Layer Controls -->
    <div class="weather-controls">
        <button class="weather-btn active" onclick="switchLayer('temperature')">Temperature</button>
        <button class="weather-btn" onclick="switchLayer('wind')">Wind</button>
        <button class="weather-btn" onclick="switchLayer('precipitation')">Precipitation</button>
        <button class="weather-btn" onclick="switchLayer('aqi')">Air Quality</button>
    </div>
    
    <!-- Location Badge -->
    <div class="location-badge">
        <h3 id="locationName">Sehore</h3>
        <div class="location-coords" id="locationCoords">23.2°N, 77.4°E</div>
    </div>
    
    <!-- Weather Panel -->
    <div class="weather-panel">
        <div class="weather-item">
            <div class="weather-label">
                <i class="fas fa-thermometer-half"></i>
                <span>Temperature</span>
            </div>
            <div class="weather-value temp-value" id="tempValue">29°</div>
        </div>
        <div class="weather-item">
            <div class="weather-label">
                <i class="fas fa-wind"></i>
                <span>Wind</span>
            </div>
            <div class="weather-value wind-value" id="windValue">11 kph</div>
        </div>
        <div class="weather-item">
            <div class="weather-label">
                <i class="fas fa-cloud-rain"></i>
                <span>Precipitation</span>
            </div>
            <div class="weather-value precip-value" id="precipValue">Light</div>
        </div>
        <div class="weather-item">
            <div class="weather-label">
                <i class="fas fa-smog"></i>
                <span>AQI</span>
            </div>
            <div class="weather-value aqi-value" id="aqiValue">76</div>
        </div>
    </div>
    
    <!-- Legend -->
    <div class="map-legend" id="mapLegend">
        <div class="legend-title">Temperature</div>
        <div class="legend-scale temp-gradient"></div>
        <div class="legend-labels">
            <span>-20°</span>
            <span>0°</span>
            <span>20°</span>
            <span>40°</span>
            <span>55°</span>
        </div>
    </div>
    
    <!-- Time Control Bar -->
    <div class="time-bar">
        <div class="time-display" id="timeDisplay">Saturday, 4 October 2025</div>
        <input type="range" class="time-slider" id="timeSlider" min="0" max="23" value="11" oninput="updateTime(this.value)">
        <div style="color: rgba(255,255,255,0.7); font-size: 14px;">
            <span id="hourDisplay">11:00</span>
        </div>
    </div>
    
    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>
    
    <script>
        let map;
        let currentLayer = 'temperature';
        let weatherLayers = {};
        let currentLat = 23.2;
        let currentLon = 77.4;
        let currentHour = 11;
        
        // Initialize map
        function initMap() {
            map = L.map('weatherMap', {
                center: [currentLat, currentLon],
                zoom: 6,
                zoomControl: false,
                preferCanvas: true
            });
            
            // Dark basemap
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
                attribution: '© CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            
            // Add labels on top
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}{r}.png', {
                attribution: '© CARTO',
                subdomains: 'abcd',
                maxZoom: 19,
                pane: 'shadowPane'
            }).addTo(map);
            
            // Add zoom control
            L.control.zoom({
                position: 'topright'
            }).addTo(map);
            
            // Click handler
            map.on('click', function(e) {
                currentLat = e.latlng.lat;
                currentLon = e.latlng.lng;
                document.getElementById('latInput').value = currentLat.toFixed(1);
                document.getElementById('lonInput').value = currentLon.toFixed(1);
                updateLocation();
            });
            
            // Initialize layers
            createWeatherLayers();
        }
        
        // Generate realistic temperature data
        function generateTemperatureData() {
            const points = [];
            const bounds = map.getBounds();
            const latRange = bounds.getNorth() - bounds.getSouth();
            const lngRange = bounds.getEast() - bounds.getWest();
            
            // Create grid of temperature points
            for (let i = 0; i < 50; i++) {
                for (let j = 0; j < 50; j++) {
                    const lat = bounds.getSouth() + (i / 50) * latRange;
                    const lng = bounds.getWest() + (j / 50) * lngRange;
                    
                    // Realistic temperature calculation
                    let temp = 30; // Base temperature
                    temp -= Math.abs(lat - 23) * 0.8; // Latitude effect
                    temp += Math.sin((lng - 77) * 0.05) * 3; // Longitude variation
                    temp += Math.sin(currentHour * Math.PI / 12 - Math.PI / 2) * 5; // Time of day
                    temp += (Math.random() - 0.5) * 2; // Random variation
                    
                    // Ensure realistic range
                    temp = Math.max(-10, Math.min(50, temp));
                    
                    // Intensity based on temperature
                    const intensity = (temp + 20) / 70; // Normalize to 0-1
                    
                    points.push([lat, lng, intensity]);
                }
            }
            
            return points;
        }
        
        // Generate wind data
        function generateWindData() {
            const bounds = map.getBounds();
            const windData = {
                u: [], // East-west component
                v: [], // North-south component
                lat: [],
                lon: []
            };
            
            // Create wind field
            for (let i = 0; i < 20; i++) {
                windData.lat.push(bounds.getSouth() + i * (bounds.getNorth() - bounds.getSouth()) / 19);
                for (let j = 0; j < 20; j++) {
                    if (i === 0) {
                        windData.lon.push(bounds.getWest() + j * (bounds.getEast() - bounds.getWest()) / 19);
                    }
                    
                    // Realistic wind pattern
                    const angle = Math.PI * 1.25 + Math.sin(i * 0.2) * 0.5; // NW dominant
                    const speed = 5 + Math.random() * 15;
                    
                    windData.u.push(Math.cos(angle) * speed);
                    windData.v.push(Math.sin(angle) * speed);
                }
            }
            
            return windData;
        }
        
        // Generate precipitation data
        function generatePrecipitationData() {
            const points = [];
            const bounds = map.getBounds();
            
            // Create precipitation clusters
            const clusters = 3 + Math.floor(Math.random() * 4);
            for (let c = 0; c < clusters; c++) {
                const centerLat = bounds.getSouth() + Math.random() * (bounds.getNorth() - bounds.getSouth());
                const centerLng = bounds.getWest() + Math.random() * (bounds.getEast() - bounds.getWest());
                const radius = 0.5 + Math.random() * 1.5;
                
                // Add points around cluster center
                for (let i = 0; i < 100; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const r = Math.random() * radius;
                    const lat = centerLat + Math.cos(angle) * r;
                    const lng = centerLng + Math.sin(angle) * r;
                    const intensity = Math.max(0, 1 - (r / radius)) * (0.5 + Math.random() * 0.5);
                    
                    if (lat >= bounds.getSouth() && lat <= bounds.getNorth() &&
                        lng >= bounds.getWest() && lng <= bounds.getEast()) {
                        points.push([lat, lng, intensity]);
                    }
                }
            }
            
            return points;
        }
        
        // Generate AQI data
        function generateAQIData() {
            const cities = [
                { lat: 23.2, lng: 77.4, aqi: 76, name: 'Sehore' },
                { lat: 23.25, lng: 77.41, aqi: 80, name: 'Bhopal' },
                { lat: 22.72, lng: 75.86, aqi: 95, name: 'Indore' },
                { lat: 26.45, lng: 74.64, aqi: 85, name: 'Ajmer' },
                { lat: 21.15, lng: 79.09, aqi: 70, name: 'Nagpur' }
            ];
            
            const points = [];
            
            cities.forEach(city => {
                // Create gradient around city
                for (let i = 0; i < 50; i++) {
                    const angle = (i / 50) * Math.PI * 2;
                    for (let r = 0; r < 1; r += 0.1) {
                        const lat = city.lat + Math.cos(angle) * r;
                        const lng = city.lng + Math.sin(angle) * r;
                        const intensity = city.aqi / 500 * (1 - r);
                        points.push([lat, lng, intensity]);
                    }
                }
            });
            
            return points;
        }
        
        // Create weather layers
        function createWeatherLayers() {
            // Temperature heatmap layer
            weatherLayers.temperature = L.heatLayer([], {
                radius: 25,
                blur: 15,
                maxZoom: 17,
                gradient: {
                    0.0: '#053061',
                    0.1: '#2166ac',
                    0.2: '#4393c3',
                    0.3: '#92c5de',
                    0.4: '#d1e5f0',
                    0.5: '#f7f7f7',
                    0.6: '#fddbc7',
                    0.7: '#f4a582',
                    0.8: '#d6604d',
                    0.9: '#b2182b',
                    1.0: '#67001f'
                }
            });
            
            // Wind layer (using canvas)
            weatherLayers.wind = L.layerGroup();
            
            // Precipitation layer
            weatherLayers.precipitation = L.heatLayer([], {
                radius: 35,
                blur: 25,
                maxZoom: 17,
                gradient: {
                    0.0: 'rgba(0,0,0,0)',
                    0.2: 'rgba(115,178,255,0.4)',
                    0.4: 'rgba(0,132,255,0.6)',
                    0.6: 'rgba(255,170,0,0.8)',
                    0.8: 'rgba(255,0,0,0.9)',
                    1.0: 'rgba(200,0,255,1)'
                }
            });
            
            // AQI layer
            weatherLayers.aqi = L.heatLayer([], {
                radius: 40,
                blur: 30,
                maxZoom: 17,
                gradient: {
                    0.0: 'rgba(0,228,0,0.6)',
                    0.2: 'rgba(255,255,0,0.6)',
                    0.5: 'rgba(255,126,0,0.7)',
                    0.8: 'rgba(255,0,0,0.8)',
                    1.0: 'rgba(153,0,76,0.9)'
                }
            });
            
            // Load initial data
            updateLayerData();
        }
        
        // Update layer data
        function updateLayerData() {
            showLoading(true);
            
            setTimeout(() => {
                // Update temperature
                const tempData = generateTemperatureData();
                weatherLayers.temperature.setLatLngs(tempData);
                
                // Update wind
                updateWindLayer();
                
                // Update precipitation
                const precipData = generatePrecipitationData();
                weatherLayers.precipitation.setLatLngs(precipData);
                
                // Update AQI
                const aqiData = generateAQIData();
                weatherLayers.aqi.setLatLngs(aqiData);
                
                // Show current layer
                switchLayer(currentLayer);
                
                showLoading(false);
            }, 500);
        }
        
        // Update wind layer with vectors
        function updateWindLayer() {
            // Clear existing wind markers
            weatherLayers.wind.clearLayers();
            
            const bounds = map.getBounds();
            const gridSize = 15;
            
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const lat = bounds.getSouth() + (i / gridSize) * (bounds.getNorth() - bounds.getSouth());
                    const lng = bounds.getWest() + (j / gridSize) * (bounds.getEast() - bounds.getWest());
                    
                    // Wind direction and speed
                    const windAngle = -Math.PI / 4 + Math.sin(i * 0.3) * 0.5; // NW wind
                    const windSpeed = 5 + Math.random() * 15;
                    
                    // Create wind barb
                    const barbHtml = `
                        <div style="
                            transform: rotate(${windAngle}rad);
                            width: 2px;
                            height: ${20 + windSpeed}px;
                            background: linear-gradient(to top, 
                                rgba(77,171,247,0.2), 
                                rgba(77,171,247,0.8));
                            position: relative;
                        ">
                            <div style="
                                position: absolute;
                                top: 0;
                                left: -3px;
                                width: 0;
                                height: 0;
                                border-left: 4px solid transparent;
                                border-right: 4px solid transparent;
                                border-bottom: 8px solid rgba(77,171,247,0.9);
                            "></div>
                        </div>
                    `;
                    
                    const windIcon = L.divIcon({
                        html: barbHtml,
                        className: 'wind-barb',
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });
                    
                    L.marker([lat, lng], { icon: windIcon }).addTo(weatherLayers.wind);
                }
            }
        }
        
        // Switch between layers
        function switchLayer(layer) {
            currentLayer = layer;
            
            // Remove all layers
            Object.values(weatherLayers).forEach(l => map.removeLayer(l));
            
            // Add selected layer
            weatherLayers[layer].addTo(map);
            
            // Update button states
            document.querySelectorAll('.weather-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(layer)) {
                    btn.classList.add('active');
                }
            });
            
            // Update legend
            updateLegend(layer);
        }
        
        // Update legend
        function updateLegend(layer) {
            const legend = document.getElementById('mapLegend');
            const title = legend.querySelector('.legend-title');
            const scale = legend.querySelector('.legend-scale');
            const labels = legend.querySelector('.legend-labels');
            
            switch(layer) {
                case 'temperature':
                    title.textContent = 'Temperature';
                    scale.className = 'legend-scale temp-gradient';
                    labels.innerHTML = '<span>-20°</span><span>0°</span><span>20°</span><span>40°</span><span>55°</span>';
                    break;
                case 'wind':
                    title.textContent = 'Wind Speed (kph)';
                    scale.className = 'legend-scale wind-gradient';
                    labels.innerHTML = '<span>0</span><span>30</span><span>60</span><span>90</span><span>120</span>';
                    break;
                case 'precipitation':
                    title.textContent = 'Precipitation';
                    scale.className = 'legend-scale precip-gradient';
                    labels.innerHTML = '<span>None</span><span>Light</span><span>Moderate</span><span>Heavy</span><span>Extreme</span>';
                    break;
                case 'aqi':
                    title.textContent = 'Air Quality Index';
                    scale.className = 'legend-scale aqi-gradient';
                    labels.innerHTML = '<span>0</span><span>100</span><span>200</span><span>300</span><span>500</span>';
                    break;
            }
        }
        
        // Update location
        function updateLocation() {
            currentLat = parseFloat(document.getElementById('latInput').value);
            currentLon = parseFloat(document.getElementById('lonInput').value);
            
            if (isNaN(currentLat) || isNaN(currentLon)) return;
            
            map.setView([currentLat, currentLon], map.getZoom());
            updateLocationInfo();
            updateWeatherInfo();
            updateLayerData();
        }
        
        // Update location info
        function updateLocationInfo() {
            // Determine location name
            let locationName = 'Unknown Location';
            if (Math.abs(currentLat - 23.2) < 0.1 && Math.abs(currentLon - 77.4) < 0.1) {
                locationName = 'Sehore';
            } else if (Math.abs(currentLat - 23.25) < 0.1 && Math.abs(currentLon - 77.41) < 0.1) {
                locationName = 'Bhopal';
            } else if (currentLat > 25 && currentLat < 30 && currentLon > 75 && currentLon < 80) {
                locationName = 'Rajasthan Region';
            } else if (currentLat > 20 && currentLat < 25 && currentLon > 75 && currentLon < 80) {
                locationName = 'Madhya Pradesh';
            }
            
            document.getElementById('locationName').textContent = locationName;
            document.getElementById('locationCoords').textContent = 
                `${currentLat.toFixed(1)}°${currentLat >= 0 ? 'N' : 'S'}, ${currentLon.toFixed(1)}°${currentLon >= 0 ? 'E' : 'W'}`;
        }
        
        // Update weather info
        function updateWeatherInfo() {
            // Calculate weather based on location and time
            let temp = 30 - Math.abs(currentLat - 23) * 0.8;
            temp += Math.sin(currentHour * Math.PI / 12 - Math.PI / 2) * 5;
            temp = Math.round(temp);
            
            const windSpeed = Math.round(5 + Math.random() * 15);
            const aqi = Math.round(50 + Math.abs(currentLat - 23) * 10 + Math.random() * 30);
            const precip = Math.random() > 0.7 ? 'Moderate' : Math.random() > 0.4 ? 'Light' : 'None';
            
            document.getElementById('tempValue').textContent = `${temp}°`;
            document.getElementById('windValue').textContent = `${windSpeed} kph`;
            document.getElementById('precipValue').textContent = precip;
            document.getElementById('aqiValue').textContent = aqi;
            
            // Update AQI color
            const aqiEl = document.getElementById('aqiValue');
            if (aqi < 50) aqiEl.style.color = '#69db7c';
            else if (aqi < 100) aqiEl.style.color = '#feca57';
            else if (aqi < 150) aqiEl.style.color = '#ff8787';
            else aqiEl.style.color = '#ff6b6b';
        }
        
        // Update time
        function updateTime(hour) {
            currentHour = parseInt(hour);
            const displayHour = currentHour < 10 ? '0' + currentHour : currentHour;
            document.getElementById('hourDisplay').textContent = `${displayHour}:00`;
            
            updateWeatherInfo();
            updateLayerData();
        }
        
        // Show/hide loading
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }
        
        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                lat: params.get('lat') || 23.2,
                lon: params.get('lon') || 77.4
            };
        }
        
        // Initialize
        window.onload = function() {
            // Get coordinates from URL if provided
            const params = getUrlParams();
            currentLat = parseFloat(params.lat);
            currentLon = parseFloat(params.lon);
            
            // Update input fields
            document.getElementById('latInput').value = currentLat;
            document.getElementById('lonInput').value = currentLon;
            
            initMap();
            updateLocationInfo();
            updateWeatherInfo();
        };
    </script>
</body>
</html>
